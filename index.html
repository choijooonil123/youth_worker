<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>ì²­ì†Œë…„ì§€ë„ì‚¬ ë©´ì ‘ ì—°ìŠµ ì‹œìŠ¤í…œ</title>
  <style>
    :root{ --bg:#0b1020; --panel:#10183a; --ink:#eaf0ff; --muted:#a7b3d4; --brand:#6aa6ff; --accent:#a176ff; --ok:#4cd97b; --danger:#ff6a6a; }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Noto Sans KR,Segoe UI,Roboto,sans-serif;color:var(--ink);background:radial-gradient(1200px 800px at 80% -10%,#1a2650 0%,#0b1020 45%)}
    header{padding:18px 20px 10px;display:flex;gap:10px;align-items:center}
    .spacer{flex:1}
    header h1{margin:0;font-size:18px}
    .pill{border:1px solid #28376e;border-radius:999px;color:var(--muted);padding:6px 10px;font-size:12px}
    
    .wrap{max-width:1200px;margin:0 auto;padding:10px 16px 40px}
    .panel{border:1px solid #263062;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,0));box-shadow:0 10px 40px rgba(0,0,0,.35)}
    .toolbar{display:flex;gap:10px;align-items:center;padding:14px;border-bottom:1px solid #283162;flex-wrap:wrap}
    .toolbar .btn{border:1px solid #2b3769;background:#16214a;color:var(--ink);padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
    .toolbar .btn:hover{background:#1a2a56}
    .toolbar .stat{color:var(--muted);font-size:13px}
    .toolbar select{border:1px solid #2b3769;background:#0f1633;color:var(--ink);padding:8px 10px;border-radius:10px;min-width:220px}
    .counts{display:flex;gap:12px;align-items:center}
    .counts .pill{border-color:#2b3769}

    .grid{display:grid;gap:8px;padding:12px;grid-template-columns:1fr}
    .qbtn{display:block;width:100%;text-align:left;background:#0f1633;border:1px solid #1f2a5a;border-radius:12px;color:var(--ink);padding:10px;margin:4px 0;cursor:pointer;font-size:14px;line-height:1.32}
    .qbtn:hover{background:#121b3e}

    dialog{width:min(920px,96vw);background:#0c122a;border:1px solid #243064;border-radius:16px;color:var(--ink)}
    dialog::backdrop{background:rgba(0,10,30,.6);backdrop-filter:blur(3px)}
    .dlg{padding:16px;display:flex;flex-direction:column;gap:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{border:1px solid #304080;background:#15204a;color:var(--ink);padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:700}
    .btn.primary{background:linear-gradient(180deg,#1f3d92,#1a2c6d);border-color:#2f47a8}
    .btn.ok{background:#123b2a;border-color:#0d5b3a}
    .btn.danger{background:#3a1330;border-color:#7a244f}
    .answer-box{background:#0b1330;border:1px solid #212c5c;border-radius:14px;padding:12px;min-height:56px;white-space:pre-wrap}
    textarea{width:100%;background:#0b1330;color:var(--ink);border:1px solid #212c5c;border-radius:14px;padding:8px;resize:vertical;min-height:80px}
    .score{font-size:36px;font-weight:800}
  </style>
</head>
<body>
  <header>
    <div class="pill">ì²­ì†Œë…„ì§€ë„ì‚¬ ë©´ì ‘ ëŒ€ë¹„</div>
    <h1>ë¡œê·¸ì¸ ë° í•™ìŠµ ì‹œìŠ¤í…œ</h1>
    <div class="spacer"></div>
    <div id="headerRank" class="pill" style="display:none"></div>
    <div id="headerUser" class="pill" style="display:none"></div>
    <button id="logoutBtn" class="btn" style="display:none">ë¡œê·¸ì•„ì›ƒ</button>
  </header>

  <div class="wrap">
    <div id="loginPanel" class="panel">
      <div style="padding:20px;display:flex;flex-direction:column;gap:12px">
        <h2>ë¡œê·¸ì¸</h2>
        <input id="username" placeholder="ì‚¬ìš©ì ì´ë¦„" style="padding:8px;border-radius:6px;border:1px solid #2b3769;background:#0f1633;color:var(--ink)">
        <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸" style="padding:8px;border-radius:6px;border:1px solid #2b3769;background:#0f1633;color:var(--ink)">
        <button id="loginBtn" class="btn primary">ë¡œê·¸ì¸</button>
        <div id="rankList" style="margin-top:20px"></div>
      </div>
    </div>

    <div id="mainPanel" class="panel" style="display:none">
      <div class="toolbar">
        <button id="resetProgress" class="btn">ì´ˆê¸°í™”</button>
        <label for="subjectSelect" class="stat">ê³¼ëª© ì„ íƒ:</label>
        <select id="subjectSelect"></select>
        <div class="counts">
          <div class="pill" id="countTotal">ì´ìˆ˜: 0</div>
          <div class="pill" id="countLearned">ìŠµë“ìˆ˜: 0</div>
        </div>
        <button id="addQuestionBtn" class="btn">ìƒˆ ì§ˆë¬¸ ì¶”ê°€</button>
      </div>
      <div id="grid" class="grid"></div>
    </div>
  </div>

  <dialog id="qd">
    <div class="dlg">
      <h2 id="qTitle">ì§ˆë¬¸</h2>
      <div class="row">
        <button id="speakBtn" class="btn">ğŸ”Š ì§ˆë¬¸ ë‹¤ì‹œë“£ê¸°</button>
        <button id="recordBtn" class="btn">ğŸ¤ ë‹µë³€ë…¹ìŒ</button>
        <button id="submitBtn" class="btn primary">âœ… ë‹µë³€ì™„ë£Œ</button>
        <button id="addAnswerBtn" class="btn">â• ë‹µë³€ ì¶”ê°€</button>
        <button id="deleteQuestionBtn" class="btn danger">ğŸ—‘ ì§ˆë¬¸ ì‚­ì œ</button>
        <button id="learnedBtn" class="btn ok">ğŸ“Œ ìŠµë“ì™„ë£Œ</button>
        <button id="closeBtn" class="btn danger">âŒ ë‹«ê¸°</button>
      </div>
      <div>
        <div class="answer-box" id="userAnswer"></div>
      </div>
      <div id="result"></div>
      <div id="extraAnswers"></div>
    </div>
  </dialog>

  <script>
    // ===== ì €ì¥ í‚¤ =====
    // ëª¨ë“  ì‚¬ìš©ìì—ê²Œ ê³µìœ ë˜ëŠ” ë¬¸ì œ/ì •ë‹µ ì €ì¥
    const STORAGE_KEY = 'yj_shared_data_v2';
    // ì‚¬ìš©ìë³„ ìŠµë“ ì§„í–‰ë„ ì €ì¥
    const PROGRESS_KEY = 'yj_progress_v2';

    // ===== ì „ì—­ ìƒíƒœ =====
    let raw = [];          // ì „ì²´ ë¬¸ì œ(ê¸°ë³¸ JSON + ê³µìœ  ë¬¸ì œ ë³‘í•©, ì¤‘ë³µ ì œê±°)
    let data = [];         // í™”ë©´ í‘œì‹œìš©(ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ ìŠµë“ ë¬¸í•­ ì œì™¸)
    let currentUser = null;
    let currentIdx = null; // rawì˜ _idx
    let recognition = null;

    // ===== ìœ í‹¸ =====
    const normSubj = s => (s && String(s).trim()) ? String(s).trim() : 'ê¸°íƒ€';
    const esc = s => String(s).replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
    const qId = q => `${normSubj(q.subject)}::${q.question}`;

    function loadShared(){ try{return JSON.parse(localStorage.getItem(STORAGE_KEY)||'[]');}catch{return []} }
    function saveShared(arr){ localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }
    function loadProgress(){ try{return JSON.parse(localStorage.getItem(PROGRESS_KEY)||'{}');}catch{return {}} }
    function saveProgress(obj){ localStorage.setItem(PROGRESS_KEY, JSON.stringify(obj)); }

    // ===== ìˆœìœ„/í—¤ë” =====
    function renderRanks(){
      const p = loadProgress();
      const rows = Object.keys(p).map(u=>({u, c:(p[u]?.learnedIds||[]).length})).sort((a,b)=>b.c-a.c).slice(0,50);
      const div = document.getElementById('rankList');
      if(!div) return;
      div.innerHTML = '<h3>ìŠµë“ ìˆœìœ„</h3>' + (rows.map((r,i)=>`<div>${i+1}. ${esc(r.u)} : ${r.c}</div>`).join('') || '<div style="opacity:.7">ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>');
    }
    function updateHeaderUser(){
      const rankEl=document.getElementById('headerRank');
      const userEl=document.getElementById('headerUser');
      const lo=document.getElementById('logoutBtn');
      if(!currentUser){ rankEl.style.display='none'; userEl.style.display='none'; lo.style.display='none'; return; }
      const p=loadProgress(); const my=(p[currentUser]?.learnedIds||[]).length;
      const rows=Object.keys(p).map(u=>({u,c:(p[u]?.learnedIds||[]).length})).sort((a,b)=>b.c-a.c);
      const idx = rows.findIndex(x=>x.u===currentUser);
      rankEl.textContent = `ìˆœìœ„: ${idx>=0? (idx+1)+'ìœ„' : '-'} Â· ìŠµë“ìˆ˜: ${my}`;
      userEl.textContent  = `ì‚¬ìš©ì: ${currentUser}`;
      rankEl.style.display='inline-block'; userEl.style.display='inline-block'; lo.style.display='inline-block';
    }

    // ===== ë°ì´í„° ë¡œë“œ / ë³‘í•© =====
    const FALLBACK = [
      { subject:'ìƒ˜í”Œê³¼ëª©', question:'ì²­ì†Œë…„ìƒë‹´ì—ì„œ ë¼í¬ì˜ í•µì‹¬ì€?', answer:'ì§„ì •ì„±, ê³µê°, ì¡´ì¤‘ì„ í†µí•´ ì‹ ë¢°ê´€ê³„ë¥¼ í˜•ì„±' },
      { subject:'ìƒ˜í”Œê³¼ëª©', question:'ì²­ì†Œë…„ ì •ì±…ì˜ 3ëŒ€ ì¶•ì€?', answer:'ë³´í˜¸, ì°¸ì—¬, ë°œë‹¬' }
    ];

    async function loadBase(){
      try{
        const r = await fetch('youth_quiz_data.json',{cache:'no-store'});
        if(!r.ok) throw 0;
        const j = await r.json();
        return Array.isArray(j)&&j.length ? j : FALLBACK;
      }catch{ return FALLBACK; }
    }
    function standardize(base){
      return base.map(x=>({
        subject: normSubj(x.subject),
        question: x.question,
        answers: Array.isArray(x.answers)? x.answers.filter(Boolean) : [(x.answer||'')].filter(Boolean),
        active: (typeof x.active==='number'? x.active:0)
      }));
    }
    function mergeWithShared(baseStd){
      const map = new Map();
      baseStd.forEach(q=> map.set(qId(q), {...q}) );
      const shared = loadShared();
      (Array.isArray(shared)? shared : []).forEach(q=>{
        const id = qId(q);
        if(map.has(id)){
          const cur = map.get(id);
          const add = (q.answers||[]).filter(Boolean);
          cur.answers = [...new Set([...(cur.answers||[]), ...add])];
        }else{
          map.set(id,{ subject:normSubj(q.subject), question:q.question, answers:(q.answers||[]).filter(Boolean), active:(q.active||0) });
        }
      });
      raw = Array.from(map.values()).map((q,i)=> ({...q, _idx:i}));
    }

    // ===== ì‚¬ìš©ìë³„ ìŠµë“ í•„í„° ë° ë Œë” =====
    function applyLearnedFilterForCurrentUser(){
      const p = loadProgress();
      const learned = currentUser ? new Set((p[currentUser]?.learnedIds)||[]) : new Set();
      data = raw.filter(q=> !learned.has(qId(q))).map(q=>({...q}));
    }

    function subjects(){ return Array.from(new Set(raw.map(x=>normSubj(x.subject)))).sort(); }
    function initSubjectSelect(){
      const sel = document.getElementById('subjectSelect');
      const subs = subjects();
      sel.innerHTML = subs.map(s=>`<option value="${esc(s)}">${esc(s)}</option>`).join('');
      if(subs.length) sel.value=subs[0];
      sel.onchange = ()=>{ renderBySubject(currentSubject()); };
    }
    function currentSubject(){ const sel=document.getElementById('subjectSelect'); return sel&&sel.value?sel.value:(subjects()[0]||'ê¸°íƒ€'); }
    function renderBySubject(subj){
      const grid=document.getElementById('grid');
      const list = data.filter(x=>normSubj(x.subject)===subj)
                       .map(q=>`<button class="qbtn" onclick="openQuestion(${q._idx})" title="${esc(q.question)}">${esc(q.question)}</button>`).join('');
      grid.innerHTML = list || `<div style="padding:12px;opacity:.7">ì´ ê³¼ëª©ì˜ ë‚¨ì€ ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    }

    // ===== ì¹´ìš´íŠ¸(ìš”êµ¬ì‚¬í•­) =====
    // ì´ìˆ˜: ì „ì²´ ë¬¸ì œ ìˆ˜(raw ì „ì²´)
    // ìŠµë“ìˆ˜: ê³¼ëª© ë¬´ê´€, ë¡œê·¸ì¸ ì‚¬ìš©ìì˜ ëˆ„ì  ìŠµë“ ìˆ˜
    function updateCounts(){
      const totalAll = raw.length;
      const p = loadProgress();
      const learnedCnt = currentUser ? ((p[currentUser]?.learnedIds||[]).length) : 0;
      document.getElementById('countTotal').textContent   = `ì´ìˆ˜: ${totalAll}`;
      document.getElementById('countLearned').textContent = `ìŠµë“ìˆ˜: ${learnedCnt}`;
    }

    // ===== ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ/ì´ˆê¸°í™” =====
    document.getElementById('loginBtn').onclick = async ()=>{
      const name=document.getElementById('username').value.trim();
      const pass=document.getElementById('password').value;
      if(!name||!pass){ alert('ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      currentUser = name;
      const p=loadProgress(); if(!p[currentUser]){ p[currentUser]={learnedIds:[]}; saveProgress(p); }
      document.getElementById('loginPanel').style.display='none';
      document.getElementById('mainPanel').style.display='block';
      await bootstrap();
    };
    document.getElementById('logoutBtn').onclick = ()=>{
      currentUser=null;
      document.getElementById('mainPanel').style.display='none';
      document.getElementById('loginPanel').style.display='block';
      renderRanks(); updateHeaderUser();
    };
    document.getElementById('resetProgress').onclick = ()=>{
      if(!currentUser){ alert('ë¡œê·¸ì¸ í›„ ì‚¬ìš©í•˜ì„¸ìš”.'); return; }
      const p=loadProgress(); p[currentUser]={learnedIds:[]}; saveProgress(p);
      applyLearnedFilterForCurrentUser();
      renderBySubject(currentSubject());
      updateCounts();
      renderRanks();
      updateHeaderUser();
    };

    // ===== ì§ˆë¬¸ ì—´ê¸°/ë‹«ê¸° =====
    function openQuestion(idx){
      currentIdx = idx;
      const q = raw.find(x=>x._idx===idx); if(!q) return;
      document.getElementById('qTitle').textContent = q.question;
      document.getElementById('userAnswer').textContent = '';
      document.getElementById('result').innerHTML = '';
      renderAnswerList();
      document.getElementById('qd').showModal();
      speak(q.question);
    }
    function closeQuestion(){ if(recognition){ recognition.stop(); recognition=null; } document.getElementById('qd').close(); }
    window.openQuestion = openQuestion;
    document.getElementById('closeBtn').onclick = closeQuestion;

    // ===== ìŒì„± í•©ì„±/ì¸ì‹ =====
    function speak(txt){ const u=new SpeechSynthesisUtterance(txt); u.lang='ko-KR'; speechSynthesis.cancel(); speechSynthesis.speak(u); }
    document.getElementById('speakBtn').onclick = ()=>{ const q=raw.find(x=>x._idx===currentIdx); if(q) speak(q.question); };

    function startRecognition(){
      window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!window.SpeechRecognition){ alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„± ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'); return; }
      recognition = new SpeechRecognition();
      recognition.lang='ko-KR'; recognition.continuous=true; recognition.interimResults=true;
      let finalTranscript='';
      recognition.onresult = (event)=>{
        let interim='';
        for(let i=event.resultIndex;i<event.results.length;i++){
          const t=event.results[i][0].transcript;
          if(event.results[i].isFinal){ finalTranscript += t + ' '; } else { interim += t; }
        }
        document.getElementById('userAnswer').textContent = (finalTranscript+interim).trim();
      };
      recognition.start();
    }
    document.getElementById('recordBtn').onclick = ()=>{
      document.getElementById('userAnswer').textContent='(ë…¹ìŒì¤‘...)';
      startRecognition();
    };

    // ===== ìœ ì‚¬ë„ & ë‹µë³€ì™„ë£Œ =====
    function similarity(a,b){
      const sa=new Set(String(a).split(/\s+/).filter(Boolean));
      const sb=new Set(String(b).split(/\s+/).filter(Boolean));
      let inter=0; sa.forEach(w=>{ if(sb.has(w)) inter++; });
      return inter/(sa.size+sb.size-inter||1);
    }
    document.getElementById('submitBtn').onclick = ()=>{
      const q = raw.find(x=>x._idx===currentIdx); if(!q) return;
      const gold = (q.answers&&q.answers.length)? (q.answers[q.active||0]||q.answers[0]) : '';
      const user = document.getElementById('userAnswer').textContent;
      const sim = similarity(user, gold);
      document.getElementById('result').innerHTML = `<div class='answer-box'>${esc(gold)}</div><div class='score'>ìœ ì‚¬ë„ ${(sim*100).toFixed(1)}%</div>`;
      speak('ì •ë‹µì…ë‹ˆë‹¤. ' + gold);
    };

    // ===== ìŠµë“ì™„ë£Œ =====
    document.getElementById('learnedBtn').onclick = ()=>{
      if(!currentUser){ alert('ë¡œê·¸ì¸ í›„ ì‚¬ìš©í•˜ì„¸ìš”.'); return; }
      const q = raw.find(x=>x._idx===currentIdx); if(!q) return;
      const p = loadProgress(); p[currentUser]=p[currentUser]||{learnedIds:[]};
      const id = qId(q);
      if(!p[currentUser].learnedIds.includes(id)) p[currentUser].learnedIds.push(id);
      saveProgress(p);
      closeQuestion();
      applyLearnedFilterForCurrentUser();
      renderBySubject(currentSubject());
      updateCounts();
      renderRanks();
      updateHeaderUser();
    };

    // ===== ì •ë‹µ ëª©ë¡ ë Œë” & ê³µìœ  ì¶”ê°€/ì‚­ì œ =====
    function renderAnswerList(){
      const holder = document.getElementById('extraAnswers');
      const q = raw.find(x=>x._idx===currentIdx); if(!q){ holder.innerHTML=''; return; }
      const items = (q.answers||[]).map((ans,i)=>{
        const checked = (q.active||0)===i ? 'checked' : '';
        return `<div style="display:flex;gap:8px;align-items:flex-start;margin:6px 0">
          <input type="radio" name="ansPick" value="${i}" ${checked} style="margin-top:4px"/>
          <div style="flex:1">${esc(ans)}</div>
          <button class="btn danger" data-del-ans="${i}">ğŸ—‘</button>
        </div>`;
      }).join('') || '<div style="opacity:.7">ë“±ë¡ëœ ì •ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</div>';
      holder.innerHTML = `<h3 style="margin:10px 0 6px">ì •ë‹µ ëª©ë¡</h3>` + items;

      // ì„ íƒ ë³€ê²½
      holder.querySelectorAll('input[name="ansPick"]').forEach(r=>{
        r.addEventListener('change',(e)=>{ q.active = parseInt(e.target.value,10)||0; });
      });
      // ê°œë³„ ì‚­ì œ(ê³µìœ  ë°˜ì˜)
      holder.querySelectorAll('[data-del-ans]').forEach(btn=>{
        btn.addEventListener('click',()=>{
          const i = parseInt(btn.getAttribute('data-del-ans'),10);
          q.answers.splice(i,1);
          if((q.active||0)>=q.answers.length) q.active=Math.max(0,q.answers.length-1);
          const bank=loadShared();
          const idx=bank.findIndex(it=> qId(it)===qId(q));
          if(idx>=0){ bank[idx].answers = q.answers.slice(); saveShared(bank); }
          renderAnswerList();
        });
      });
    }

    document.getElementById('addAnswerBtn').onclick = ()=>{
      const q = raw.find(x=>x._idx===currentIdx); if(!q) return;
      const val = prompt('ì¶”ê°€í•  ì •ë‹µ(ë³€í˜•)ì„ ì…ë ¥í•˜ì„¸ìš”'); if(!val) return;
      q.answers = q.answers || [];
      if(!q.answers.includes(val)) q.answers.push(val);
      q.active = q.answers.length-1;
      // ê³µìœ  ë°˜ì˜
      const bank = loadShared();
      const idx  = bank.findIndex(it=> qId(it)===qId(q));
      if(idx>=0){
        const arr = Array.isArray(bank[idx].answers)? bank[idx].answers : [];
        if(!arr.includes(val)) arr.push(val);
        bank[idx].answers = arr;
      }else{
        bank.push({ subject:q.subject, question:q.question, answers:[val], active:0 });
      }
      saveShared(bank);
      renderAnswerList();
    };

    // ===== ìƒˆ ì§ˆë¬¸ ì¶”ê°€(ëª¨ë“  ì‚¬ìš©ì ê³µìœ ) =====
    document.getElementById('addQuestionBtn').onclick = ()=>{
      const subj = prompt('ê³¼ëª©ëª…ì„ ì…ë ¥í•˜ì„¸ìš”'); if(!subj) return;
      const ques = prompt('ìƒˆ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”'); if(!ques) return;
      const answ = prompt('ì •ë‹µ(ëª¨ë²”ë‹µì•ˆ)ì„ ì…ë ¥í•˜ì„¸ìš”'); if(!answ) return;
      const bank = loadShared();
      const id = `${normSubj(subj)}::${ques}`;
      const exists = bank.some(x=> `${normSubj(x.subject)}::${x.question}`===id) || raw.some(x=> qId(x)===id);
      if(exists){ alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ë¬¸í•­ì…ë‹ˆë‹¤.'); return; }
      bank.push({ subject:normSubj(subj), question:ques, answers:[answ], active:0 });
      saveShared(bank);
      bootstrap(); // ì „ì²´ ìƒˆë¡œ ë³‘í•©/ë Œë”
    };

    // ===== ì§ˆë¬¸ ì‚­ì œ(ê³µìœ ë¡œ ì¶”ê°€ëœ ë¬¸í•­ë§Œ ì „ì—­ ì‚­ì œ) =====
    document.getElementById('deleteQuestionBtn').onclick = ()=>{
      const q=raw.find(x=>x._idx===currentIdx); if(!q) return;
      if(!confirm('ì´ ì§ˆë¬¸ì„ ëª¨ë“  ì‚¬ìš©ìì—ê²Œì„œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ê³µìœ ë¡œ ì¶”ê°€ëœ ë¬¸í•­ë§Œ ì‚­ì œë©ë‹ˆë‹¤)')) return;
      const bank=loadShared();
      const idx=bank.findIndex(it=> qId(it)===qId(q));
      if(idx>=0){ bank.splice(idx,1); saveShared(bank); alert('ê³µìœ  ë¬¸í•­ì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.'); bootstrap(); }
      else { alert('ê¸°ë³¸ ë°ì´í„° ë¬¸í•­ì€ ì „ì—­ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); }
    };

    // ===== ë¶€íŠ¸ìŠ¤íŠ¸ë© =====
    async function bootstrap(){
      const base = await loadBase();
      const std  = standardize(base);
      mergeWithShared(std);
      applyLearnedFilterForCurrentUser();
      initSubjectSelect();
      renderBySubject(currentSubject());
      updateCounts();
      renderRanks();
      updateHeaderUser();
    }

    // ì´ˆê¸° ì§„ì…: ìˆœìœ„ë§Œ ë Œë”
    renderRanks();
  </script>
</body>
</html>